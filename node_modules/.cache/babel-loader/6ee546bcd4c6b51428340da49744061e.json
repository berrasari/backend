{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _extends from \"@babel/runtime/helpers/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { memo, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport get from 'lodash/get';\nimport upperFirst from 'lodash/upperFirst';\nimport { useIntl } from 'react-intl';\nimport styled from 'styled-components';\nimport { BaseCheckbox } from '@strapi/design-system/BaseCheckbox';\nimport { Box } from '@strapi/design-system/Box';\nimport { Flex } from '@strapi/design-system/Flex';\nimport { Typography } from '@strapi/design-system/Typography';\n\nvar IS_DISABLED = function () {\n  if (window && window.strapi && window.strapi.isEE) {\n    return require('../../../../../../../../../../../ee/admin/pages/SettingsPage/pages/Roles/EditPage/components/ContentTypeCollapse/CollapsePropertyMatrix/SubActionRow/utils/constants')[\"default\"];\n  }\n\n  return require('./utils/constants')[\"default\"];\n}();\n\nimport { usePermissionsDataManager } from '../../../../../../../../../hooks';\nimport CollapseLabel from '../../../CollapseLabel';\nimport Curve from '../../../Curve';\nimport HiddenAction from '../../../HiddenAction';\nimport { cellWidth, rowHeight } from '../../../Permissions/utils/constants';\nimport RequiredSign from '../../../RequiredSign';\nimport { getCheckboxState } from '../../../utils';\nimport { activeStyle } from '../../utils';\nimport CarretIcon from '../CarretIcon';\nvar Cell = /*#__PURE__*/styled(Flex).withConfig({\n  displayName: \"SubActionRow__Cell\",\n  componentId: \"sc-7y8yzq-0\"\n})([\"width:\", \";position:relative;\"], cellWidth);\nvar RowWrapper = /*#__PURE__*/styled(Flex).withConfig({\n  displayName: \"SubActionRow__RowWrapper\",\n  componentId: \"sc-7y8yzq-1\"\n})([\"height:\", \";\"], rowHeight);\nvar Wrapper = /*#__PURE__*/styled(Box).withConfig({\n  displayName: \"SubActionRow__Wrapper\",\n  componentId: \"sc-7y8yzq-2\"\n})([\"padding-left:\", \"rem;\"], 31 / 16);\nvar LeftBorderTimeline = /*#__PURE__*/styled(Box).withConfig({\n  displayName: \"SubActionRow__LeftBorderTimeline\",\n  componentId: \"sc-7y8yzq-3\"\n})([\"border-left:\", \";\"], function (_ref) {\n  var isVisible = _ref.isVisible,\n      theme = _ref.theme;\n  return isVisible ? \"4px solid \".concat(theme.colors.primary200) : '4px solid transparent';\n});\nvar RowStyle = /*#__PURE__*/styled(Flex).withConfig({\n  displayName: \"SubActionRow__RowStyle\",\n  componentId: \"sc-7y8yzq-4\"\n})([\"padding-left:\", \";width:\", \"px;\", \" \", \";\"], function (_ref2) {\n  var theme = _ref2.theme;\n  return theme.spaces[4];\n}, function (_ref3) {\n  var level = _ref3.level;\n  return 145 - level * 36;\n}, function (_ref4) {\n  var isCollapsable = _ref4.isCollapsable,\n      theme = _ref4.theme;\n  return isCollapsable && \"\\n      \".concat(CarretIcon, \" {\\n        display: block;\\n        color: \").concat(theme.colors.neutral100, \";\\n      }\\n      &:hover {\\n        \").concat(activeStyle(theme), \"\\n      }\\n  \");\n}, function (_ref5) {\n  var isActive = _ref5.isActive,\n      theme = _ref5.theme;\n  return isActive && activeStyle(theme);\n});\nvar TopTimeline = /*#__PURE__*/styled.div.withConfig({\n  displayName: \"SubActionRow__TopTimeline\",\n  componentId: \"sc-7y8yzq-5\"\n})([\"padding-top:\", \";margin-top:\", \";width:\", \"rem;background-color:\", \";border-top-left-radius:2px;border-top-right-radius:2px;\"], function (_ref6) {\n  var theme = _ref6.theme;\n  return theme.spaces[2];\n}, function (_ref7) {\n  var theme = _ref7.theme;\n  return theme.spaces[2];\n}, 4 / 16, function (_ref8) {\n  var theme = _ref8.theme;\n  return theme.colors.primary200;\n});\n\nvar SubActionRow = function SubActionRow(_ref9) {\n  var childrenForm = _ref9.childrenForm,\n      isFormDisabled = _ref9.isFormDisabled,\n      recursiveLevel = _ref9.recursiveLevel,\n      pathToDataFromActionRow = _ref9.pathToDataFromActionRow,\n      propertyActions = _ref9.propertyActions,\n      parentName = _ref9.parentName,\n      propertyName = _ref9.propertyName;\n\n  var _useIntl = useIntl(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _usePermissionsDataMa = usePermissionsDataManager(),\n      modifiedData = _usePermissionsDataMa.modifiedData,\n      onChangeParentCheckbox = _usePermissionsDataMa.onChangeParentCheckbox,\n      onChangeSimpleCheckbox = _usePermissionsDataMa.onChangeSimpleCheckbox;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      rowToOpen = _useState2[0],\n      setRowToOpen = _useState2[1];\n\n  var handleClickToggleSubLevel = function handleClickToggleSubLevel(name) {\n    setRowToOpen(function (prev) {\n      if (prev === name) {\n        return null;\n      }\n\n      return name;\n    });\n  };\n\n  var displayedRecursiveChildren = useMemo(function () {\n    if (!rowToOpen) {\n      return null;\n    }\n\n    return childrenForm.find(function (_ref10) {\n      var value = _ref10.value;\n      return value === rowToOpen;\n    });\n  }, [rowToOpen, childrenForm]);\n  return /*#__PURE__*/React.createElement(Wrapper, null, /*#__PURE__*/React.createElement(TopTimeline, null), childrenForm.map(function (_ref11, index) {\n    var label = _ref11.label,\n        value = _ref11.value,\n        required = _ref11.required,\n        subChildrenForm = _ref11.children;\n    var isVisible = index + 1 < childrenForm.length;\n    var isArrayType = Array.isArray(subChildrenForm);\n    var isActive = rowToOpen === value;\n    return /*#__PURE__*/React.createElement(LeftBorderTimeline, {\n      key: value,\n      isVisible: isVisible\n    }, /*#__PURE__*/React.createElement(RowWrapper, null, /*#__PURE__*/React.createElement(Curve, {\n      color: \"primary200\"\n    }), /*#__PURE__*/React.createElement(Flex, {\n      style: {\n        flex: 1\n      }\n    }, /*#__PURE__*/React.createElement(RowStyle, {\n      level: recursiveLevel,\n      isActive: isActive,\n      isCollapsable: isArrayType\n    }, /*#__PURE__*/React.createElement(CollapseLabel, _extends({\n      alignItems: \"center\",\n      isCollapsable: isArrayType\n    }, isArrayType && {\n      onClick: function onClick() {\n        return handleClickToggleSubLevel(value);\n      },\n      'aria-expanded': isActive,\n      onKeyDown: function onKeyDown(_ref12) {\n        var key = _ref12.key;\n        return (key === 'Enter' || key === ' ') && handleClickToggleSubLevel(value);\n      },\n      tabIndex: 0,\n      role: 'button'\n    }, {\n      title: label\n    }), /*#__PURE__*/React.createElement(Typography, {\n      ellipsis: true\n    }, upperFirst(label)), required && /*#__PURE__*/React.createElement(RequiredSign, null), /*#__PURE__*/React.createElement(CarretIcon, {\n      $isActive: isActive\n    }))), /*#__PURE__*/React.createElement(Flex, {\n      style: {\n        flex: 1\n      }\n    }, propertyActions.map(function (_ref13) {\n      var actionId = _ref13.actionId,\n          propertyLabel = _ref13.label,\n          isActionRelatedToCurrentProperty = _ref13.isActionRelatedToCurrentProperty;\n\n      if (!isActionRelatedToCurrentProperty) {\n        return /*#__PURE__*/React.createElement(HiddenAction, {\n          key: actionId\n        });\n      }\n      /*\n       * Usually we use a 'dot' in order to know the key path of an object for which we want to change the value.\n       * Since an action and a subject are both separated by '.' or '::' we chose to use the '..' separators\n       */\n\n\n      var checkboxName = [].concat(_toConsumableArray(pathToDataFromActionRow.split('..')), [actionId, 'properties', propertyName], _toConsumableArray(parentName.split('..')), [value]);\n      var checkboxValue = get(modifiedData, checkboxName, false);\n\n      if (!subChildrenForm) {\n        return /*#__PURE__*/React.createElement(Cell, {\n          key: propertyLabel,\n          justifyContent: \"center\",\n          alignItems: \"center\"\n        }, /*#__PURE__*/React.createElement(BaseCheckbox, {\n          disabled: isFormDisabled || IS_DISABLED,\n          name: checkboxName.join('..'),\n          \"aria-label\": formatMessage({\n            id: \"Settings.permissions.select-by-permission\",\n            defaultMessage: 'Select {label} permission'\n          }, {\n            label: \"\".concat(parentName, \" \").concat(label, \" \").concat(propertyLabel)\n          }) // Keep same signature as packages/core/admin/admin/src/components/Roles/Permissions/index.js l.91\n          ,\n          onValueChange: function onValueChange(value) {\n            onChangeSimpleCheckbox({\n              target: {\n                name: checkboxName.join('..'),\n                value: value\n              }\n            });\n          },\n          value: checkboxValue\n        }));\n      }\n\n      var _getCheckboxState = getCheckboxState(checkboxValue),\n          hasAllActionsSelected = _getCheckboxState.hasAllActionsSelected,\n          hasSomeActionsSelected = _getCheckboxState.hasSomeActionsSelected;\n\n      return /*#__PURE__*/React.createElement(Cell, {\n        key: propertyLabel,\n        justifyContent: \"center\",\n        alignItems: \"center\"\n      }, /*#__PURE__*/React.createElement(BaseCheckbox, {\n        key: propertyLabel,\n        disabled: isFormDisabled || IS_DISABLED,\n        name: checkboxName.join('..'),\n        \"aria-label\": formatMessage({\n          id: \"Settings.permissions.select-by-permission\",\n          defaultMessage: 'Select {label} permission'\n        }, {\n          label: \"\".concat(parentName, \" \").concat(label, \" \").concat(propertyLabel)\n        }) // Keep same signature as packages/core/admin/admin/src/components/Roles/Permissions/index.js l.91\n        ,\n        onValueChange: function onValueChange(value) {\n          onChangeParentCheckbox({\n            target: {\n              name: checkboxName.join('..'),\n              value: value\n            }\n          });\n        },\n        value: hasAllActionsSelected,\n        indeterminate: hasSomeActionsSelected\n      }));\n    })))), displayedRecursiveChildren && isActive && /*#__PURE__*/React.createElement(Box, {\n      paddingBottom: 2\n    }, /*#__PURE__*/React.createElement(SubActionRow, {\n      isFormDisabled: isFormDisabled,\n      parentName: \"\".concat(parentName, \"..\").concat(value),\n      pathToDataFromActionRow: pathToDataFromActionRow,\n      propertyActions: propertyActions,\n      propertyName: propertyName,\n      recursiveLevel: recursiveLevel + 1,\n      childrenForm: displayedRecursiveChildren.children\n    })));\n  }));\n};\n\nSubActionRow.propTypes = {\n  childrenForm: PropTypes.array.isRequired,\n  isFormDisabled: PropTypes.bool.isRequired,\n  parentName: PropTypes.string.isRequired,\n  pathToDataFromActionRow: PropTypes.string.isRequired,\n  propertyActions: PropTypes.array.isRequired,\n  propertyName: PropTypes.string.isRequired,\n  recursiveLevel: PropTypes.number.isRequired\n};\nexport default /*#__PURE__*/memo(SubActionRow);","map":null,"metadata":{},"sourceType":"module"}